var ve=/([:*])(\w+)/g,pe="([^/]+)",ge=/\*/g,me="?(?:.*)",_e=/\/\?/g,ye="/?([^/]+|)",Le="(?:/^|^)",Ee="";function B(e){return e===void 0&&(e="/"),b()?location.pathname+location.search+location.hash:e}function l(e){return e.replace(/\/+$/,"").replace(/^\/+/,"")}function k(e){return typeof e=="string"}function Oe(e){return typeof e=="function"}function P(e){return e&&e.indexOf("#")>=0&&e.split("#").pop()||""}function Re(e,n){return n.length===0||!e?null:e.slice(1,e.length).reduce(function(i,r,o){return i===null&&(i={}),i[n[o]]=decodeURIComponent(r),i},null)}function w(e){var n=l(e).split(/\?(.*)?$/);return[l(n[0]),n.slice(1).join("")]}function S(e){for(var n={},i=e.split("&"),r=0;r<i.length;r++){var o=i[r].split("=");if(o[0]!==""){var u=decodeURIComponent(o[0]);n[u]?(Array.isArray(n[u])||(n[u]=[n[u]]),n[u].push(decodeURIComponent(o[1]||""))):n[u]=decodeURIComponent(o[1]||"")}}return n}function q(e,n){var i=w(l(e.currentLocationPath)),r=i[0],o=i[1],u=o===""?null:S(o),c=[],d;if(k(n.path)){if(d=Le+l(n.path).replace(ve,function(L,_,E){return c.push(E),pe}).replace(ge,me).replace(_e,ye)+"$",l(n.path)===""&&l(r)==="")return{url:r,queryString:o,hashString:P(e.to),route:n,data:null,params:u}}else d=n.path;var m=new RegExp(d,Ee),v=r.match(m);if(v){var O=k(n.path)?Re(v,c):v.groups?v.groups:v.slice(1);return{url:l(r.replace(new RegExp("^"+e.instance.root),"")),queryString:o,hashString:P(e.to),route:n,data:O,params:u}}return!1}function D(){return!!(typeof window!="undefined"&&window.history&&window.history.pushState)}function y(e,n){return typeof e[n]=="undefined"||e[n]===!0}function Ae(e){if(!e)return{};var n=e.split(","),i={},r;return n.forEach(function(o){var u=o.split(":").map(function(c){return c.replace(/(^ +| +$)/g,"")});switch(u[0]){case"historyAPIMethod":i.historyAPIMethod=u[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=u[1];break;case"resolveOptionsHash":r||(r={}),r.hash=u[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[u[0]]=u[1]==="true";break}}),r&&(i.resolveOptions=r),i}function b(){return typeof window!="undefined"}function ke(e,n){return e===void 0&&(e=[]),n===void 0&&(n={}),e.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(n[r]||(n[r]=[]),n[r].push(i[r]))})}),n}function g(e,n,i){var r=n||{},o=0;(function u(){if(!e[o]){i&&i(r);return}Array.isArray(e[o])?(e.splice.apply(e,[o,1].concat(e[o][0](r)?e[o][1]:e[o][2])),u()):e[o](r,function(c){typeof c=="undefined"||c===!0?(o+=1,u()):i&&i(r)})})()}g.if=function(e,n,i){return Array.isArray(n)||(n=[n]),Array.isArray(i)||(i=[i]),[e,n,i]};function W(e,n){typeof e.currentLocationPath=="undefined"&&(e.currentLocationPath=e.to=B(e.instance.root)),e.currentLocationPath=e.instance._checkForAHash(e.currentLocationPath),n()}function H(e,n){for(var i=0;i<e.instance.routes.length;i++){var r=e.instance.routes[i],o=q(e,r);if(o&&(e.matches||(e.matches=[]),e.matches.push(o),e.resolveOptions.strategy==="ONE")){n();return}}n()}function Pe(e,n){e.navigateOptions&&(typeof e.navigateOptions.shouldResolve!="undefined"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof e.navigateOptions.silent!="undefined"&&console.warn('"silent" is deprecated. Please check the documentation.')),n()}function we(e,n){e.navigateOptions.force===!0?(e.instance._setCurrent([e.instance._pathToMatchObject(e.to)]),n(!1)):n()}var X=b(),Se=D();function be(e,n){if(y(e.navigateOptions,"updateBrowserURL")){var i=("/"+e.to).replace(/\/\//g,"/"),r=X&&e.resolveOptions&&e.resolveOptions.hash===!0;Se?(history[e.navigateOptions.historyAPIMethod||"pushState"](e.navigateOptions.stateObj||{},e.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(e.instance.__freezeListening=!0,setTimeout(function(){if(!r){var o=location.hash;location.hash="",location.hash=o}e.instance.__freezeListening=!1},1))):X&&(window.location.href=e.to)}n()}function z(e,n){var i=e.instance;if(!i.lastResolved()){n();return}g(i.lastResolved().map(function(r){return function(o,u){if(!r.route.hooks||!r.route.hooks.leave){u();return}var c=!1,d=e.instance.matchLocation(r.route.path,e.currentLocationPath,!1);if(r.route.path!=="*")c=!d;else{var m=e.matches?e.matches.find(function(v){return r.route.path===v.route.path}):!1;c=!m}if(y(e.navigateOptions,"callHooks")&&c){g(r.route.hooks.leave.map(function(v){return function(O,L){return v(function(_){_===!1?e.instance.__markAsClean(e):L()},e.matches&&e.matches.length>0?e.matches.length===1?e.matches[0]:e.matches:void 0)}}).concat([function(){return u()}]));return}else u()}}),{},function(){return n()})}function He(e,n){e.match.route.hooks&&e.match.route.hooks.before&&y(e.navigateOptions,"callHooks")?g(e.match.route.hooks.before.map(function(i){return function(o,u){return i(function(c){c===!1?e.instance.__markAsClean(e):u()},e.match)}}).concat([function(){return n()}])):n()}function Ce(e,n){y(e.navigateOptions,"callHandler")&&e.match.route.handler(e.match),e.instance.updatePageLinks(),n()}function Fe(e,n){e.match.route.hooks&&e.match.route.hooks.after&&y(e.navigateOptions,"callHooks")&&e.match.route.hooks.after.forEach(function(i){return i(e.match)}),n()}function Te(e,n){var i=e.instance.lastResolved();if(i&&i[0]&&i[0].route===e.match.route&&i[0].url===e.match.url&&i[0].queryString===e.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&y(e.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(o){return o(e.match)})}),n(!1);return}n()}function Ne(e,n){var i=e.instance._notFoundRoute;if(i){e.notFoundHandled=!0;var r=w(e.currentLocationPath),o=r[0],u=r[1],c=P(e.to);i.path=l(o);var d={url:i.path,queryString:u,hashString:c,data:null,route:i,params:u!==""?S(u):null};e.matches=[d],e.match=d}n()}function Ue(e,n){(!e.resolveOptions||e.resolveOptions.noMatchWarning===!1||typeof e.resolveOptions.noMatchWarning=="undefined")&&console.warn('Navigo: "'+e.currentLocationPath+`" didn't match any of the registered routes.`),n()}function Ie(e,n){e.instance._setCurrent(null),n()}function K(e,n){y(e.navigateOptions,"updateState")&&e.instance._setCurrent(e.matches),n()}var V=[Te,He,Ce,Fe],$=[z,Ne,g.if(function(e){var n=e.notFoundHandled;return n},V.concat([K]),[Ue,Ie])];function C(){return C=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},C.apply(this,arguments)}function Q(e,n){var i=0;function r(){if(i===e.matches.length){K(e,n);return}g(V,C({},e,{match:e.matches[i]}),function(){i+=1,r()})}z(e,r)}function F(e){e.instance.__markAsClean(e)}function T(){return T=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},T.apply(this,arguments)}var Y="[data-navigo]";function Ge(e,n){var i=n||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Y},r=this,o="/",u=null,c=[],d=!1,m,v=D(),O=b();e?o=l(e):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function L(t){return t.indexOf("#")>=0&&(i.hash===!0?t=t.split("#")[1]||"/":t=t.split("#")[0]),t}function _(t){return l(o+"/"+l(t))}function E(t,a,s,h){return t=k(t)?_(t):t,{name:h||l(String(t)),path:t,handler:a,hooks:ke(s)}}function J(t,a,s){var h=this;return typeof t=="object"&&!(t instanceof RegExp)?(Object.keys(t).forEach(function(f){if(typeof t[f]=="function")h.on(f,t[f]);else{var p=t[f],R=p.uses,le=p.as,de=p.hooks;c.push(E(f,R,[m,de],le))}}),this):(typeof t=="function"&&(s=a,a=t,t=o),c.push(E(t,a,[m,s])),this)}function N(t,a){if(r.__dirty){r.__waiting.push(function(){return r.resolve(t,a)});return}else r.__dirty=!0;t=t?l(o)+"/"+l(t):void 0;var s={instance:r,to:t,currentLocationPath:t,navigateOptions:{},resolveOptions:T({},i,a)};return g([W,H,g.if(function(h){var f=h.matches;return f&&f.length>0},Q,$)],s,F),s.matches?s.matches:!1}function U(t,a){if(r.__dirty){r.__waiting.push(function(){return r.navigate(t,a)});return}else r.__dirty=!0;t=l(o)+"/"+l(t);var s={instance:r,to:t,navigateOptions:a||{},resolveOptions:a&&a.resolveOptions?a.resolveOptions:i,currentLocationPath:L(t)};g([Pe,we,H,g.if(function(h){var f=h.matches;return f&&f.length>0},Q,$),be,F],s,F)}function Z(t,a,s){var h=G(t,a);return h!==null?(U(h.replace(new RegExp("^/?"+o),""),s),!0):!1}function x(t){return this.routes=c=c.filter(function(a){return k(t)?l(a.path)!==l(t):Oe(t)?t!==a.handler:String(a.path)!==String(t)}),this}function ee(){v&&(this.__popstateListener=function(){r.__freezeListening||N()},window.addEventListener("popstate",this.__popstateListener))}function te(){this.routes=c=[],v&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=d=!0}function ne(t,a){return r._notFoundRoute=E("*",t,[m,a],"__NOT_FOUND__"),this}function I(){if(!!O)return re().forEach(function(t){if(t.getAttribute("data-navigo")==="false"||t.getAttribute("target")==="_blank"){t.hasListenerAttached&&t.removeEventListener("click",t.navigoHandler);return}t.hasListenerAttached||(t.hasListenerAttached=!0,t.navigoHandler=function(a){if((a.ctrlKey||a.metaKey)&&a.target.tagName.toLowerCase()==="a")return!1;var s=t.getAttribute("href");if(typeof s=="undefined"||s===null)return!1;if(s.match(/^(http|https)/)&&typeof URL!="undefined")try{var h=new URL(s);s=h.pathname+h.search}catch(p){}var f=Ae(t.getAttribute("data-navigo-options"));d||(a.preventDefault(),a.stopPropagation(),r.navigate(l(s),f))},t.addEventListener("click",t.navigoHandler))}),r}function re(){return O?[].slice.call(document.querySelectorAll(i.linksSelector||Y)):[]}function ie(t){return"/"+o+"/"+l(t)}function ae(t){return m=t,this}function oe(){return u}function G(t,a,s){var h=c.find(function(R){return R.name===t}),f=null;if(h){if(f=h.path,a)for(var p in a)f=f.replace(":"+p,a[p]);f=f.match(/^\//)?f:"/"+f}return f&&s&&!s.includeRoot&&(f=f.replace(new RegExp("^/"+o),"")),f}function se(t){return t.getAttribute("href")}function M(t){var a=w(l(t)),s=a[0],h=a[1],f=h===""?null:S(h),p=P(t),R=E(s,function(){},[m],s);return{url:s,queryString:h,hashString:p,route:R,data:null,params:f}}function ue(){return M(l(B(o)).replace(new RegExp("^"+o),""))}function fe(t){var a={instance:r,currentLocationPath:t,to:t,navigateOptions:{},resolveOptions:i};return H(a,function(){}),a.matches?a.matches:!1}function ce(t,a,s){typeof a!="undefined"&&(typeof s=="undefined"||s)&&(a=_(a));var h={instance:r,to:a,currentLocationPath:a};W(h,function(){}),typeof t=="string"&&(t=typeof s=="undefined"||s?_(t):t);var f=q(h,{name:String(t),path:t,handler:function(){},hooks:{}});return f||!1}function A(t,a,s){return typeof a=="string"&&(a=j(a)),a?(a.hooks[t]||(a.hooks[t]=[]),a.hooks[t].push(s),function(){a.hooks[t]=a.hooks[t].filter(function(h){return h!==s})}):(console.warn("Route doesn't exists: "+a),function(){})}function j(t){return typeof t=="string"?c.find(function(a){return a.name===_(t)}):c.find(function(a){return a.handler===t})}function he(t){t.instance.__dirty=!1,t.instance.__waiting.length>0&&t.instance.__waiting.shift()()}this.root=o,this.routes=c,this.destroyed=d,this.current=u,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=he,this.on=J,this.off=x,this.resolve=N,this.navigate=U,this.navigateByName=Z,this.destroy=te,this.notFound=ne,this.updatePageLinks=I,this.link=ie,this.hooks=ae,this.extractGETParameters=function(t){return w(L(t))},this.lastResolved=oe,this.generate=G,this.getLinkPath=se,this.match=fe,this.matchLocation=ce,this.getCurrentLocation=ue,this.addBeforeHook=A.bind(this,"before"),this.addAfterHook=A.bind(this,"after"),this.addAlreadyHook=A.bind(this,"already"),this.addLeaveHook=A.bind(this,"leave"),this.getRoute=j,this._pathToMatchObject=M,this._clean=l,this._checkForAHash=L,this._setCurrent=function(t){return u=r.current=t},ee.call(this),I.call(this)}export{Ge as N};
